# 任务清单

本任务清单按照用户可见价值优先和依赖关系组织,每个任务都是可验证的小步骤。

## 第一阶段:数据层扩展 (并行可能)

### 1. 扩展数据库辅助函数 ✅
**工作项:**
- [x] 在 `src/services/storage/db.ts` 添加 `deleteConversation(conversationId)` 函数
- [x] 添加 `renameConversation(conversationId, newTitle)` 函数  
- [x] 添加 `exportConversation(conversationId)` 函数返回Markdown字符串

**验证:**
- [x] 函数能正确级联删除对话和消息
- [x] 重命名能更新title和updatedAt字段
- [x] 导出生成符合规范的Markdown格式

**依赖:** 无
**预计工作量:** 30分钟

### 2. 扩展useChat Hook管理功能 ✅
**工作项:**
- [x] 在 `src/hooks/useChat.ts` 添加 `deleteConversation` 方法
- [x] 添加 `renameConversation` 方法
- [x] 添加 `exportConversation` 方法
- [x] 修改 `createNewConversation` 使用首条消息作为标题

**验证:**
- [x] 删除对话后自动切换到剩余对话或null
- [x] 重命名后对话列表立即更新
- [x] 导出触发浏览器下载Markdown文件

**依赖:** 任务1完成
**预计工作量:** 45分钟

## 第二阶段:UI组件开发

### 3. 创建ConversationList组件 ✅
**工作项:**
- [x] 创建 `src/components/chat/ConversationList.tsx`
- [x] 实现对话列表展示(标题、时间、激活状态)
- [x] 实现相对时间显示逻辑
- [x] 实现空状态UI

**验证:**
- [x] 对话列表按updatedAt倒序显示
- [x] 激活对话有视觉高亮
- [x] 空状态显示友好提示

**依赖:** 无(可与任务1-2并行)
**预计工作量:** 60分钟

### 4. 添加对话操作按钮 ✅
**工作项:**
- [x] 在ConversationList添加悬停显示操作按钮
- [x] 实现重命名按钮和内联编辑功能
- [x] 实现删除按钮和确认对话框
- [x] 实现导出按钮

**验证:**
- [x] 悬停显示操作按钮,非悬停隐藏
- [x] 重命名支持Enter确认、Esc取消
- [x] 删除需要用户确认
- [x] 导出下载文件名正确

**依赖:** 任务2、3完成
**预计工作量:** 60分钟

### 5. 实现对话列表折叠功能 ✅
**工作项:**
- [x] 在ConversationList添加折叠/展开按钮
- [x] 实现折叠状态管理(useState + localStorage)
- [x] 折叠时仅显示图标按钮,展开时显示完整列表
- [x] 调整ChatPanel布局以适应折叠/展开状态

**验证:**
- [x] 点击按钮能切换折叠状态
- [x] 折叠状态持久化到localStorage
- [x] 刷新页面保持折叠状态
- [x] 布局平滑过渡

**依赖:** 任务3、4完成
**预计工作量:** 30分钟

## 第三阶段:集成和优化

### 6. 集成ConversationList到ChatPanel ✅
**工作项:**
- [x] 修改 `src/components/chat/ChatPanel.tsx` 布局
- [x] 左侧集成ConversationList组件(占20-25%宽度)
- [x] 右侧保留现有消息区域和输入框
- [x] 传递useChat hook的状态和方法给ConversationList

**验证:**
- [x] 对话列表和消息区域并排显示
- [x] 响应式布局正常工作
- [x] 切换对话时消息区域正确更新
- [x] 删除对话不影响消息显示逻辑

**依赖:** 任务2、5完成
**预计工作量:** 30分钟

### 7. 优化智能标题生成 ✅
**工作项:**
- [x] 修改useChat的sendMessage方法
- [x] 首次发送消息时,用消息前30字符更新对话标题
- [x] 处理特殊字符(换行符转空格,trim首尾)
- [x] 空消息保持默认标题"新对话"

**验证:**
- [x] 新对话发送首条消息后标题自动更新
- [x] 长消息截取30字符并添加"..."
- [x] 标题显示在对话列表中

**依赖:** 任务2、6完成
**预计工作量:** 20分钟

### 8. 错误处理和边界情况 ✅
**工作项:**
- [x] 为删除、重命名、导出操作添加try-catch
- [x] 实现错误提示UI(toast或alert)
- [x] 处理空标题提交
- [x] 处理删除最后一个对话的情况

**验证:**
- [x] 数据库操作失败显示友好错误提示
- [x] 空标题无法提交
- [x] 删除最后对话后显示空状态
- [x] 异常不会导致UI崩溃

**依赖:** 任务6完成
**预计工作量:** 30分钟

## 第四阶段:测试和文档

### 9. 手动功能测试 ✅
**工作项:**
- [x] 测试对话列表显示和排序
- [x] 测试切换、删除、重命名、导出功能
- [x] 测试折叠/展开功能
- [x] 测试智能标题生成
- [x] 测试边界情况(空列表、最后对话、错误处理)

**验证:**
- [x] 所有功能符合规范要求
- [x] 无UI崩溃或数据丢失
- [x] 交互流畅,体验良好

**依赖:** 任务1-8完成
**预计工作量:** 45分钟

### 10. 代码审查和优化 ✅
**工作项:**
- [x] 检查代码风格和命名规范
- [x] 优化数据库查询性能
- [x] 检查TypeScript类型安全
- [x] 移除未使用的代码和注释

**验证:**
- [x] 代码符合项目conventions
- [x] 无TypeScript编译错误
- [x] 数据库查询使用索引
- [x] 代码简洁无冗余

**依赖:** 任务9完成
**预计工作量:** 30分钟

## 总预计工作量
约 6-7 小时,分多次迭代完成

## 并行工作建议
- 任务1-2(数据层)可与任务3(UI组件)并行开发
- 测试可在每个任务完成后立即进行,无需等待全部完成
