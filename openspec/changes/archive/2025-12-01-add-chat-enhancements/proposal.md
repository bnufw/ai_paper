# 提案: add-chat-enhancements

## 概述
为AI对话功能添加两项增强能力：
1. **图片上传** - 允许用户在对话中添加图片，利用Gemini的多模态能力进行图文问答
2. **论文引用(@功能)** - 允许用户在对话中@其他论文，自动读取目标论文的paper.md内容作为上下文

## 动机
当前对话系统仅支持纯文本交互，存在以下限制：
- 用户无法针对论文中的图表、公式截图进行提问
- 用户无法在讨论一篇论文时引用另一篇相关论文的内容进行对比分析

这两个功能是学术研究场景中的常见需求。

## 影响范围

### 功能1：图片上传
- **UI层**: `ChatPanel.tsx` - 添加图片上传按钮和预览
- **数据层**: `Message` 类型需扩展支持图片数据
- **服务层**: `geminiClient.ts` - 调整API调用以支持多模态输入
- **存储层**: `db.ts` - 消息表需支持存储图片（base64或引用）

### 功能2：论文引用
- **UI层**: `ChatPanel.tsx` - 实现@提及的输入检测和论文选择器
- **Hook层**: `useChat.ts` - 处理@引用的解析和内容注入
- **服务层**: 读取目标论文的paper.md文件内容

## 技术约束
1. Gemini API支持多模态输入（图片+文本）
2. 图片需压缩后存储，避免IndexedDB容量问题
3. @引用仅读取paper.md纯文本，不读取图片和PDF以控制token消耗
4. 需要访问本地文件系统读取其他论文的paper.md

## 规范变更
本次变更创建两个新的能力规范：
1. `chat-image-upload` - 聊天图片上传能力
2. `chat-paper-reference` - 聊天论文引用能力

## 相关规范
- `chat-history-management` - 现有对话管理规范，本次变更需与其保持一致

## 状态
- **状态**: 待审核
- **创建时间**: 2024-01-30
